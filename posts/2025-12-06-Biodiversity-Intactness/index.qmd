---
title: "Biodiversity Intactness Index change in Phoenix, AZ"
description: "This analysis maps and quantifies areas in Phoenix, Arizona where high Biodiversity Intactness Index (BII ≥ 0.75) declined between 2017 and 2020."
author:
  - name: Austin Martinez
    url: http://austinmartinez12.github.io/
    affiliation: Master of Environmental Data Science @ The Bren School of Enviromental Management
    affiliation-url: https://ucsb-meds.github.io/
date: 12-06-2025
categories: [Python]
bibliography: references.bib
citation:
  url: https://github.com/austinmartinez12/urbanization-bii-mapping
image: Arizona.png
draft: false
---

# Biodiversity Intactness Index change in Phoenix, AZ

### Author: Austin Martinez

### GitHub Repository: https://github.com/austinmartinez12/urbanization-bii-mapping

## About Section

#### Purpose:

The purpose of this project was to analyze the Biodiversity Intactness Index(BII) in the Phoenix, Arizona subdivision between 2017 and 2020. Specifically, this project aimed to identify and quantify the amount of area with a BII ≥ 0.75 in 2017 but experienced a decline by 2020. By visualizing this decline in BII, I can more clearly show the extent of biodiversity loss across the Phoenix subdivision.

#### Highlights:

-   Accessed and explored BII data from the Microsoft Planetary Computer STAC catalog
-   Clipped BII rasters to match the extent of the Phoenix subdivision
-   Calculated the percentage of area with BII ≥ 0.75
-   Identified and Visualized areas that experienced BII decline from 2017-2020

#### About the data:

-   cb_2018_04_cousub_500k.shp: This cartographic boundary file is a simplified representation of Arizona's subdivisions. It was produced by the Census Bureau’s MAF/TIGER geographic database.
-   Microsoft Planetary Computer STAC catalog: was generated by the Impact Observatory, in collaboration with Vizzuality, these datasets estimate terrestrial Biodiversity Intactness as 100-meter gridded maps for the years 2017-2020.

#### References:

-   

    1.  U.S. Census Bureau. (2024, October 30). Cartographic boundary files – Shapefile. https://www.census.gov/geographies/mapping-files/time-series/geo/carto-boundary-file.html \[Accessed Dec. 05, 2025\]

-   

    2.  Impact Observatory, Vizzuality, & Microsoft. (2025). Biodiversity Intactness: 100m gridded maps for 2017–2020 \[Data set\]. Microsoft Planetary Computer. https://planetarycomputer.microsoft.com/api/stac/v1/collections/io-biodiversity \[Accessed Dec. 05, 2025\]

## Reading in data

```{python}
# Load in Libraries
import os
import pandas as pd
import geopandas as gpd
import xarray as xr
import rioxarray as rio
import matplotlib.pyplot as plt
import contextily as ctx
import planetary_computer
from pystac_client import Client 
import matplotlib.patches as patch
```

The code chunk below is used to access the io-biodiversity collection from the Microsoft Planetary Computer STAC catalog to collect 2017 and 2020 BII rasters covering the Phoenix subdivision.

```{python}
# Access MPC catalog
catalog = Client.open(
    "https://planetarycomputer.microsoft.com/api/stac/v1",
    modifier=planetary_computer.sign_inplace,
)

catalog.get_collections()
collections = list(catalog.get_collections()) # Turn generator into list

# Print the number of collections
print('Number of collections:', len(collections))

# Pull out the NAIP collection
naip_collection = catalog.get_child('naip')
print(naip_collection)

# Temporal range of interest during drought
time_range = '2017-01-01/2020-01-01'

# Bounding box containing phoenix
bbox =[-112.826843, 32.974108, -111.184387, 33.863574]

# Get items from search
search = catalog.search(
    collections = ['io-biodiversity'],
    bbox = bbox,
    datetime = time_range)

# Determine number of items in search
items = search.item_collection()
print(len(items))
```

The code below creates a reproducible file path to access the census data for Arizona subdivisions. This shape file contains polygons for all subdivisions in Arizona, so I had to select the Phoenix polygon. This will be used to clip the rasters.

```{python}
# Create a reproducible file path for Arizona subdivisions data
az_path = os.path.join("data", "cb_2018_04_cousub_500k", "cb_2018_04_cousub_500k.shp")

# Read in census data for Arizona subdivisions
az_subdiv = gpd.read_file(az_path)

# Select the Phoenix Subdivision
phoenix = az_subdiv[az_subdiv["NAME"] == "Phoenix"]
```

## Data analysis

The code below was used to explore the data read in from the Microsoft Planetary Computer STAC catalog. I wrote a description of what I obtained from the preliminary data exploration below.

```{python}
# Print the total number of rasters
print(f"Total rasters returned: {len(items)}", "\n")

# Print items to find where data is
print(f"Assets: {items[0].assets}", "\n")

# Print the CRS
print("CRS:", items[0].properties.get("proj:epsg"), "\n")

# Print raster bands
print("Raster bands:", items[0].assets["data"].extra_fields.get("raster:bands"))
```

After exploring the data I found that there are a total of 4 rasters. 1 for every year (2017-2020). After checking the item assets, I found that the data is in 'data'. The CRS is EPSG:4326, which is different the phoenix polygon's CRS. This will need to be resolved later on in the analysis.

### Study Area

The code below is used to create a map showing the Phoenix subdivision within its broader geographic context. The purple polygon shows the extent of the study area.

```{python}
# Create a map showing the Phoenix subdivision within its broader geographic context
fig, ax = plt.subplots(1, 1, figsize=(9, 6))

# Add Phoenix, AZ Subdivision
phoenix.plot(ax=ax, facecolor='purple', edgecolor='black', linewidth=1, alpha=0.25)

# Add basemap using contextily
ctx.add_basemap(ax, source=ctx.providers.OpenStreetMap.Mapnik, crs = az_subdiv.crs)

# Add title
ax.set_title('Phoenix, AZ Subdivision')

# Remove axes
ax.axis('off')

# Display the map
plt.tight_layout()
plt.show()
```

The next 5 code chunks are used to extract 2017 and 2020 rasters from the search. These were used to calculate the percentage of area of the Phoenix subdivision with a BII of at least 0.75 in 2017 and 2020. These values were then used to identify and visualize the amount of area with a BII ≥ 0.75 in 2017 but experienced a decline by 2020.

```{python}
# Select 2017 and 2020 rasters from search
item_2020 = items[0]
item_2017 = items[3]

# Extract 2017 and 2020 rasters using open_rasterio()
phx_2020 = rio.open_rasterio(item_2020.assets['data'].href)
phx_2017 = rio.open_rasterio(item_2017.assets['data'].href)
```

```{python}
# Match phoenix CRSs to phx_2020
phoenix = phoenix.to_crs(phx_2020.rio.crs)

# Clip 2017 and 2020 rasters to match phoenix shape
phx_2020_clip = phx_2020.rio.clip_box(*phoenix.total_bounds).rio.clip(phoenix.geometry)
phx_2017_clip = phx_2017.rio.clip_box(*phoenix.total_bounds).rio.clip(phoenix.geometry)
```

```{python}
# Identify values >= .75 in rasters
BII_75per_2020 = phx_2020_clip >= .75
BII_75per_2017 = phx_2017_clip >= .75

# Calculate the percent of area in each raster with BII ≥ 0.75
Bii_2020 = (BII_75per_2020.sum() / BII_75per_2020.count())*100
Bii_2017 = (BII_75per_2017.sum() / BII_75per_2017.count())*100
```

```{python}
# Find pixels that had a BII >= .75 in 2017 but not in 2020
Bii_lost_area = BII_75per_2017 & (~BII_75per_2020)

# Convert all 0 values to NAs if they don't meet the condition
Bii_lost_area_mask = Bii_lost_area.where(Bii_lost_area!=0)
```

```{python}
# Create a visualization showing the area with BII>=0.75 in 2017 that was lost by 2020
fig, ax = plt.subplots(figsize=(7, 6))

# Create choropleth map
phx_2020_clip.plot(cmap = 'Greens', cbar_kwargs={'location':'bottom', # Legend location
                                                 'label':'BII for 2020'})

# Plot the lost area
Bii_lost_area_mask.plot(ax=ax, cmap='Reds', add_colorbar = False)

# Add title
plt.suptitle('Biodiversity Intactness Index (BII)', fontsize=17, weight = 'bold')

# Add subtitle
ax.set_title('Phoenix, AZ Subdivision', fontsize=17, weight='bold')

# Add legend of BII
legend_elements = [patch.Patch(facecolor='red', 
                         label='Area with BII ≥ 0.75 lost from 2017 to 2020')]

# Add a legend for BII loss
ax.legend(handles=legend_elements, loc='upper center', bbox_to_anchor=(0.5, -0.05), ncol=5, edgecolor = "white")

# Remove axes
ax.axis('off')

# Display the map
plt.tight_layout()
plt.show()
```

## Map Description

The map above shows the Biodiversity Intactness Index (BII) across the Phoenix, AZ subdivision(in green), and areas where BII was \>= .75 in 2017 but dropped in 2020(in red). These red ares are an indication that wild areas in the Phoenix region are decreasing in biodiversity compared to what would be expected in undisturbed ecosystems. This decline is most likely driven by fragmentation and urbanization.
