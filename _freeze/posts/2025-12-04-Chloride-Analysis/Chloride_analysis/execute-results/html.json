{
  "hash": "20160811123c6065068033e9e2ac1922",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Chloride Contamination Analysis\"\ndescription: \"Identifying drivers of lake contamination by chloride in the Midwest and Northeast United States\"\nformat: \n  html: \n    code-fold: false\n    embed-resources: true\neditor: visual\nauthor:\n  - name: Austin Martinez\n    url: http://austinmartinez12.github.io/\n    affiliation: Master of Environmental Data Science @ The Bren School of Enviromental Management\n    affiliation-url: https://ucsb-meds.github.io/\ndate: 12/04/2025\"\ncategories: [R]\nbibliography: references.bib\ncitation:\n  url: http://austinmartinez12.github.io/posts/2025-12-04-Chloride-Analysis/\nimage: lake.png\ndraft: false\nexecute: \n  echo: true\n  message: false\n  warning: false\n---\n\n# Identifying drivers of lake contamination by chloride in the Midwest and Northeast United States\n\n## Purpose\n\nThe purpose of this project is to identify different drivers of lake contamination by anthropogenic chloride in Midwest and Northeast United States. Its important to identify drivers of chloride contamination because of its negative effects on ecosystems and drinking water quality. By seeing what variables have a positive effect on chloride concentrations, we can better identify lakes at risk.\n\n## Data\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load in libraries\nsuppressPackageStartupMessages({\nlibrary(here)\nlibrary(tidyverse)\nlibrary(dplyr)\nlibrary(broom)\nlibrary(knitr)\nlibrary(kableExtra)})\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Read in data\ndf <- suppressMessages(read_csv(here('posts', '2025-12-04-Chloride-Analysis', 'data', 'edi.452.2', \"lakeCL_trainingData.csv\")))\n```\n:::\n\n\nThe data I'm using has chloride concentrations for 2,773 lakes in the Midwest and Northeast United States. This data was collected from 1990-01-01 to 2018-12-13 and contains data about the lake's watershed characteristics, dimensions, and its proximity to roads. When the chloride concentrations are plotted on a histogram its clear the data is right skewed. Since this variable is continuous, strictly positive, and right-skewed I decided to model it with a GLM with Gamma family and log link.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf |>\n  ggplot(aes(x = Chloride)) +\n  geom_histogram(bins = 50, fill = \"lightblue\", color = \"blue\") +\n  labs(title = \"Chloride Concentation in lakes\",\n       x = \"Chloride\",\n       y = \"Count\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](Chloride_analysis_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n### Study Question:\n\n-   Does the road density in a watershed impact chloride concentrations in lakes? (I'm wondering if I should run this analysis on high-intensity developed land in a watershed too)\n\n| Column | Meaning |\n|------------------------------------|------------------------------------|\n| `LakeArea` | Surface area of the lake |\n| `MaxDepth` | Maximum depth of lake |\n| `WS_Area` | Surface area of the watershed |\n| `WS_OpenWater` | \\% landuse classified as open water in the watershed |\n| `WS_Dev_High` | \\% landuse classified as developed, high intensity in the watershed |\n| `WS_RoadDensity` | Road density in the watershed |\n| `WS_Crops` | \\% landuse classified as row crops in the watershed |\n| `InterstateDistance` | Distance to the nearest interstate |\n| `RoadDistance` | Distance to the nearest road |\n| `Chloride` | Concentration of chloride in lake |\n\n![](images/Chloride_DAG.png){fig-align=\"center\" width=\"60%\"}\n\n## Data Cleaning\n\nThis data frame has multiple observations for the same lake. To resolve this I selected all rows with the same unique lake identifier(nhdid) and only kept the most recent observation.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# For lakes with multiple observations, only keep the most recent record\ndf <- df %>%\n  group_by(nhdid) %>%\n  slice_max(ActivityStartDate, n = 1, with_ties = FALSE) %>%\n  ungroup()\n```\n:::\n\n\n## Create the Model\n\nThe model below is a GLM with Gamma family and log link. In this model Chloride is the response variable and WS_RoadDensity is the predictor variable.\n\n### Statistical Notation\n\n$$ \n\\begin{align}\nChloride &\\sim \\text{Gamma}(\\mu, \\phi) \\\\\n\\log(\\mu) &= \\beta_0 + \\beta_1 \\,\\text{WSRoadDensity} + \\beta_2 \\,\\text{WSCrops} + \\beta_3 \\,\\text{WSDevHigh} \\\\\n&\\quad + \\beta_4 \\,\\text{LakeArea} + \\beta_5 \\,\\text{WSArea} + \\beta_6 \\,\\text{MaxDepth} \\\\\n&\\quad + \\beta_7 \\,\\text{WSOpenWater} + \\beta_8 \\,\\text{RoadDistance} + \\beta_9 \\,\\text{InterstateDistance}\n\\end{align} \n$$\n\n### Hypothesis\n\n$$\n\\begin{align}\nH_0 &: \\beta_1 = 0 \\\\\nH_A &: \\beta_1 != 0\n\\end{align}\n$$\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Make a Gamma model with Chloride as response and WS_RoadDensity as the predictor\nmodel_cl <- glm( Chloride ~ WS_RoadDensity \n    # Confounding variables\n    + WS_Crops + WS_Dev_High + LakeArea \n    + WS_Area + MaxDepth + WS_OpenWater +\n    RoadDistance + InterstateDistance,\n \n  family = Gamma(link = \"log\"),\n  data = df\n)\n```\n:::\n\n\n## Model Output\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Select and round model outputs to include in kable\nmodel_table <- tidy(model_cl) |> # Turn model_cl into a tidy tibble\n  mutate(\n    estimate = round(estimate, 4),\n    std.error = round(std.error, 4),\n    statistic = round(statistic, 2),\n    p.value = round(p.value, 8)\n  )\n\n# Create kable with model_cl outputs\nkable(model_table, format = \"html\", caption = \"Gamma GLM Results\") |>\n  kable_styling(full_width = TRUE, bootstrap_options = c(\"striped\")) \n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped\" style=\"margin-left: auto; margin-right: auto;\">\n<caption>Gamma GLM Results</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> term </th>\n   <th style=\"text-align:right;\"> estimate </th>\n   <th style=\"text-align:right;\"> std.error </th>\n   <th style=\"text-align:right;\"> statistic </th>\n   <th style=\"text-align:right;\"> p.value </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> (Intercept) </td>\n   <td style=\"text-align:right;\"> 2.4436 </td>\n   <td style=\"text-align:right;\"> 0.1790 </td>\n   <td style=\"text-align:right;\"> 13.65 </td>\n   <td style=\"text-align:right;\"> 0.0000000 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> WS_RoadDensity </td>\n   <td style=\"text-align:right;\"> 0.0198 </td>\n   <td style=\"text-align:right;\"> 0.0028 </td>\n   <td style=\"text-align:right;\"> 6.96 </td>\n   <td style=\"text-align:right;\"> 0.0000000 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> WS_Crops </td>\n   <td style=\"text-align:right;\"> 0.0106 </td>\n   <td style=\"text-align:right;\"> 0.0027 </td>\n   <td style=\"text-align:right;\"> 3.97 </td>\n   <td style=\"text-align:right;\"> 0.0000730 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> WS_Dev_High </td>\n   <td style=\"text-align:right;\"> 0.0308 </td>\n   <td style=\"text-align:right;\"> 0.0362 </td>\n   <td style=\"text-align:right;\"> 0.85 </td>\n   <td style=\"text-align:right;\"> 0.3946193 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> LakeArea </td>\n   <td style=\"text-align:right;\"> 0.0000 </td>\n   <td style=\"text-align:right;\"> 0.0000 </td>\n   <td style=\"text-align:right;\"> 0.34 </td>\n   <td style=\"text-align:right;\"> 0.7330230 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> WS_Area </td>\n   <td style=\"text-align:right;\"> 0.0000 </td>\n   <td style=\"text-align:right;\"> 0.0000 </td>\n   <td style=\"text-align:right;\"> 0.37 </td>\n   <td style=\"text-align:right;\"> 0.7129681 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> MaxDepth </td>\n   <td style=\"text-align:right;\"> -0.0040 </td>\n   <td style=\"text-align:right;\"> 0.0059 </td>\n   <td style=\"text-align:right;\"> -0.68 </td>\n   <td style=\"text-align:right;\"> 0.4934170 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> WS_OpenWater </td>\n   <td style=\"text-align:right;\"> -0.0043 </td>\n   <td style=\"text-align:right;\"> 0.0190 </td>\n   <td style=\"text-align:right;\"> -0.23 </td>\n   <td style=\"text-align:right;\"> 0.8202812 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> RoadDistance </td>\n   <td style=\"text-align:right;\"> -0.0426 </td>\n   <td style=\"text-align:right;\"> 0.0107 </td>\n   <td style=\"text-align:right;\"> -3.98 </td>\n   <td style=\"text-align:right;\"> 0.0000705 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> InterstateDistance </td>\n   <td style=\"text-align:right;\"> -0.0101 </td>\n   <td style=\"text-align:right;\"> 0.0012 </td>\n   <td style=\"text-align:right;\"> -8.21 </td>\n   <td style=\"text-align:right;\"> 0.0000000 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n## Simulate Data\n\nThe code chunk below uses the model_cl model to simulate data to be used in our model predictions. This data is simulated with new chloride concentration values by using fitted Gamma GLM. This is done to see if the model has reasonable assumptions. New values are simulated using the model’s estimated mean and dispersion.\n\nThe Gamma GLM assumes that:\n\n-   chloride is continuous and positive\n\n-   variance increases as the mean increases\n\n-   effects of predictor variables are multiplicative\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Set seed\nset.seed(67)\n\n# Extract coefficients from fitted model\ncoefficients <- coef(model_cl)\n# Extract the model matrix\nmatrix <- model.matrix(model_cl)\n# Perform matrix multiplication to find linear predictor\nlinear_predictor <- matrix %*% coefficients \n# exp() to get expected mean chloride concentration\nexpected_mean_cl <- exp(linear_predictor)\n# Convert model dispersion estimate to a shape parameter\ndisp <- summary(model_cl)$dispersion\nshape <- 1 / disp\n\n# Simulate new Chloride data\nChloride_sim <- rgamma(\n  n = length(expected_mean_cl),\n  shape = shape,\n  scale = expected_mean_cl / shape\n)\n\n# Assign rows used in the  model_cl model to df_model\ndf_model <- model_cl$model\n\n# Create a Chloride_sim column and insert the Chloride_sim data into it \ndf_simulated <- df_model |>\n  mutate(Chloride_sim = Chloride_sim)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create a grid for plotting WS_RoadDensity and Chloride\npred_line <- tibble(\n  WS_RoadDensity = seq(min(df_simulated$WS_RoadDensity, na.rm = TRUE),\n                    max(df_simulated$WS_RoadDensity, na.rm = TRUE),\n                    length.out = 1000),\n  # Find the mean of all confounding variables to hold them constant\n  WS_Dev_High = mean(df_simulated$WS_Dev_High, na.rm = TRUE),\n  LakeArea = mean(df_simulated$LakeArea, na.rm = TRUE),\n  WS_Area = mean(df_simulated$WS_Area, na.rm = TRUE),\n  MaxDepth = mean(df_simulated$MaxDepth, na.rm = TRUE),\n  WS_OpenWater = mean(df_simulated$WS_OpenWater, na.rm = TRUE),\n  WS_Crops = mean(df_simulated$WS_Crops, na.rm = TRUE),\n  RoadDistance = mean(df_simulated$RoadDistance, na.rm = TRUE),\n  InterstateDistance = mean(df_simulated$InterstateDistance, na.rm = TRUE)\n)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create predictions for pred_line\npreds <- predict(\n  model_cl,\n  newdata = pred_line,\n  type = \"link\",\n  se.fit = TRUE\n)\n\n# Convert link (log scale) to response scale\npred_line <- pred_line |>\n  mutate(\n    fit_link = preds$fit,\n    se_link = preds$se.fit,\n    fit = exp(fit_link),\n    lower = exp(fit_link - 1.96 * se_link),\n    upper = exp(fit_link + 1.96 * se_link)\n  )\n```\n:::\n\n\n## Data Visualization\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Plot data points, predicted mean curve, and 95% confidence interval\nggplot() +\n  geom_point(data = df_simulated, aes(x = WS_RoadDensity, y = Chloride),\n             color = \"dodgerblue\", alpha = .67) + # Data points\n  geom_ribbon(data = pred_line, aes(x = WS_RoadDensity, ymin = lower, ymax = upper),\n              alpha = 0.25, fill = \"lightblue\") + # Confidence interval\n  geom_line(data = pred_line, aes(x = WS_RoadDensity, y = fit),\n            color = \"black\", linewidth = 1) + # Predicted mean curve\n  labs(\n    title = \"Effect Road Density in Watershed on Lake Chloride\",\n    x = \"Road Density in Watershed\",\n    y = \"Chloride (mg/L)\"\n  ) +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](Chloride_analysis_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n## Restating Hypothesis\n\n-   Null hypothesis (H₀): Road density in a watershed has no effect on chloride concentrations in lakes (β₁ = 0).\n\n-   Alternative hypothesis (Hₐ): Road density has an effect on chloride concentrations in lakes (β₁ ≠ 0).\n\nDue to the fact that the p-vlaue of of `WS_RoadDensity` is much smaller than 0.05, my data rejects the null hypothesis. This means that road density in a watershed is strongly associated with chloride concentrations in lakes. According to my model for each 1-unit increase in `WS_RoadDensity` the expected chloride concentration increases by exp(0.0198) or 1.019997. This is likely caused by the fact that road salts are used to defrost roads since this is a snowy region of America.\n",
    "supporting": [
      "Chloride_analysis_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"../../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}