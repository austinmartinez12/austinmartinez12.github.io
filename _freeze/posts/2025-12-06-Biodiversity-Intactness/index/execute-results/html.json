{
  "hash": "e17856517ff473e93984f3bb1ee0d32a",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"Biodiversity Intactness Index change in Phoenix, AZ\"\ndescription: \"This analysis maps and quantifies areas in Phoenix, Arizona where high Biodiversity Intactness Index (BII ≥ 0.75) declined between 2017 and 2020.\"\nauthor:\n  - name: Austin Martinez\n    url: http://austinmartinez12.github.io/\n    affiliation: Master of Environmental Data Science @ The Bren School of Enviromental Management\n    affiliation-url: https://ucsb-meds.github.io/\ndate: 12-06-2025\ncategories: [Python]\nbibliography: references.bib\ncitation:\n  url: https://github.com/austinmartinez12/urbanization-bii-mapping\nimage: Arizona.png\ndraft: false\n---\n\n# Biodiversity Intactness Index change in Phoenix, AZ\n\n### Author: Austin Martinez\n\n### GitHub Repository: https://github.com/austinmartinez12/urbanization-bii-mapping\n\n## About Section\n\n#### Purpose:\n\nThe purpose of this project was to analyze the Biodiversity Intactness Index(BII) in the Phoenix, Arizona subdivision between 2017 and 2020. Specifically, this project aimed to identify and quantify the amount of area with a BII ≥ 0.75 in 2017 but experienced a decline by 2020. By visualizing this decline in BII, I can more clearly show the extent of biodiversity loss across the Phoenix subdivision.\n\n#### Highlights:\n\n-   Accessed and explored BII data from the Microsoft Planetary Computer STAC catalog\n-   Clipped BII rasters to match the extent of the Phoenix subdivision\n-   Calculated the percentage of area with BII ≥ 0.75\n-   Identified and Visualized areas that experienced BII decline from 2017-2020\n\n#### About the data:\n\n-   cb_2018_04_cousub_500k.shp: This cartographic boundary file is a simplified representation of Arizona's subdivisions. It was produced by the Census Bureau’s MAF/TIGER geographic database.\n-   Microsoft Planetary Computer STAC catalog: was generated by the Impact Observatory, in collaboration with Vizzuality, these datasets estimate terrestrial Biodiversity Intactness as 100-meter gridded maps for the years 2017-2020.\n\n#### References:\n\n-   \n\n    1.  U.S. Census Bureau. (2024, October 30). Cartographic boundary files – Shapefile. https://www.census.gov/geographies/mapping-files/time-series/geo/carto-boundary-file.html \\[Accessed Dec. 05, 2025\\]\n\n-   \n\n    2.  Impact Observatory, Vizzuality, & Microsoft. (2025). Biodiversity Intactness: 100m gridded maps for 2017–2020 \\[Data set\\]. Microsoft Planetary Computer. https://planetarycomputer.microsoft.com/api/stac/v1/collections/io-biodiversity \\[Accessed Dec. 05, 2025\\]\n\n## Reading in data\n\n::: {#a1641e17 .cell execution_count=1}\n``` {.python .cell-code}\n# Load in Libraries\nimport os\nimport pandas as pd\nimport geopandas as gpd\nimport xarray as xr\nimport rioxarray as rio\nimport matplotlib.pyplot as plt\nimport contextily as ctx\nimport planetary_computer\nfrom pystac_client import Client \nimport matplotlib.patches as patch\n```\n:::\n\n\nThe code chunk below is used to access the io-biodiversity collection from the Microsoft Planetary Computer STAC catalog to collect 2017 and 2020 BII rasters covering the Phoenix subdivision.\n\n::: {#cbdee762 .cell execution_count=2}\n``` {.python .cell-code}\n# Access MPC catalog\ncatalog = Client.open(\n    \"https://planetarycomputer.microsoft.com/api/stac/v1\",\n    modifier=planetary_computer.sign_inplace,\n)\n\ncatalog.get_collections()\ncollections = list(catalog.get_collections()) # Turn generator into list\n\n# Print the number of collections\nprint('Number of collections:', len(collections))\n\n# Pull out the NAIP collection\nnaip_collection = catalog.get_child('naip')\nprint(naip_collection)\n\n# Temporal range of interest during drought\ntime_range = '2017-01-01/2020-01-01'\n\n# Bounding box containing phoenix\nbbox =[-112.826843, 32.974108, -111.184387, 33.863574]\n\n# Get items from search\nsearch = catalog.search(\n    collections = ['io-biodiversity'],\n    bbox = bbox,\n    datetime = time_range)\n\n# Determine number of items in search\nitems = search.item_collection()\nprint(len(items))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nNumber of collections: 126\n<CollectionClient id=naip>\n4\n```\n:::\n:::\n\n\nThe code below creates a reproducible file path to access the census data for Arizona subdivisions. This shape file contains polygons for all subdivisions in Arizona, so I had to select the Phoenix polygon. This will be used to clip the rasters.\n\n::: {#ce26bbff .cell execution_count=3}\n``` {.python .cell-code}\n# Create a reproducible file path for Arizona subdivisions data\naz_path = os.path.join(\"data\", \"cb_2018_04_cousub_500k\", \"cb_2018_04_cousub_500k.shp\")\n\n# Read in census data for Arizona subdivisions\naz_subdiv = gpd.read_file(az_path)\n\n# Select the Phoenix Subdivision\nphoenix = az_subdiv[az_subdiv[\"NAME\"] == \"Phoenix\"]\n```\n:::\n\n\n## Data analysis\n\nThe code below was used to explore the data read in from the Microsoft Planetary Computer STAC catalog. I wrote a description of what I obtained from the preliminary data exploration below.\n\n::: {#4be972d6 .cell execution_count=4}\n``` {.python .cell-code}\n# Print the total number of rasters\nprint(f\"Total rasters returned: {len(items)}\", \"\\n\")\n\n# Print items to find where data is\nprint(f\"Assets: {items[0].assets}\", \"\\n\")\n\n# Print the CRS\nprint(\"CRS:\", items[0].properties.get(\"proj:epsg\"), \"\\n\")\n\n# Print raster bands\nprint(\"Raster bands:\", items[0].assets[\"data\"].extra_fields.get(\"raster:bands\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nTotal rasters returned: 4 \n\nAssets: {'data': <Asset href=https://pcdata01euw.blob.core.windows.net/impact/bii-v1/bii_2020/bii_2020_34.74464974521749_-115.38597824385106_cog.tif?st=2025-12-07T02%3A53%3A17Z&se=2025-12-08T03%3A38%3A17Z&sp=rl&sv=2025-07-05&sr=c&skoid=9c8ff44a-6a2c-4dfb-b298-1c9212f64d9a&sktid=72f988bf-86f1-41af-91ab-2d7cd011db47&skt=2025-12-07T22%3A45%3A39Z&ske=2025-12-14T22%3A45%3A39Z&sks=b&skv=2025-07-05&sig=06m8b0ZBroAQ68dTkPo2aYu%2Bkw65TVZYYSCg0AENWZA%3D>, 'tilejson': <Asset href=https://planetarycomputer.microsoft.com/api/data/v1/item/tilejson.json?collection=io-biodiversity&item=bii_2020_34.74464974521749_-115.38597824385106_cog&assets=data&tile_format=png&colormap_name=io-bii&rescale=0%2C1&expression=0.97%2A%28data_b1%2A%2A3.84%29&format=png>, 'rendered_preview': <Asset href=https://planetarycomputer.microsoft.com/api/data/v1/item/preview.png?collection=io-biodiversity&item=bii_2020_34.74464974521749_-115.38597824385106_cog&assets=data&tile_format=png&colormap_name=io-bii&rescale=0%2C1&expression=0.97%2A%28data_b1%2A%2A3.84%29&format=png>} \n\nCRS: None \n\nRaster bands: [{'sampling': 'area', 'data_type': 'float32', 'spatial_resolution': 100}]\n```\n:::\n:::\n\n\nAfter exploring the data I found that there are a total of 4 rasters. 1 for every year (2017-2020). After checking the item assets, I found that the data is in 'data'. The CRS is EPSG:4326, which is different the phoenix polygon's CRS. This will need to be resolved later on in the analysis.\n\n### Study Area\n\nThe code below is used to create a map showing the Phoenix subdivision within its broader geographic context. The purple polygon shows the extent of the study area.\n\n::: {#f26ab309 .cell execution_count=5}\n``` {.python .cell-code}\n# Create a map showing the Phoenix subdivision within its broader geographic context\nfig, ax = plt.subplots(1, 1, figsize=(9, 6))\n\n# Add Phoenix, AZ Subdivision\nphoenix.plot(ax=ax, facecolor='purple', edgecolor='black', linewidth=1, alpha=0.25)\n\n# Add basemap using contextily\nctx.add_basemap(ax, source=ctx.providers.OpenStreetMap.Mapnik, crs = az_subdiv.crs)\n\n# Add title\nax.set_title('Phoenix, AZ Subdivision')\n\n# Remove axes\nax.axis('off')\n\n# Display the map\nplt.tight_layout()\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-6-output-1.png){width=766 height=566}\n:::\n:::\n\n\nThe next 5 code chunks are used to extract 2017 and 2020 rasters from the search. These were used to calculate the percentage of area of the Phoenix subdivision with a BII of at least 0.75 in 2017 and 2020. These values were then used to identify and visualize the amount of area with a BII ≥ 0.75 in 2017 but experienced a decline by 2020.\n\n::: {#c22283df .cell execution_count=6}\n``` {.python .cell-code}\n# Select 2017 and 2020 rasters from search\nitem_2020 = items[0]\nitem_2017 = items[3]\n\n# Extract 2017 and 2020 rasters using open_rasterio()\nphx_2020 = rio.open_rasterio(item_2020.assets['data'].href)\nphx_2017 = rio.open_rasterio(item_2017.assets['data'].href)\n```\n:::\n\n\n::: {#afb950e5 .cell execution_count=7}\n``` {.python .cell-code}\n# Match phoenix CRSs to phx_2020\nphoenix = phoenix.to_crs(phx_2020.rio.crs)\n\n# Clip 2017 and 2020 rasters to match phoenix shape\nphx_2020_clip = phx_2020.rio.clip_box(*phoenix.total_bounds).rio.clip(phoenix.geometry)\nphx_2017_clip = phx_2017.rio.clip_box(*phoenix.total_bounds).rio.clip(phoenix.geometry)\n```\n:::\n\n\n::: {#0001fb03 .cell execution_count=8}\n``` {.python .cell-code}\n# Identify values >= .75 in rasters\nBII_75per_2020 = phx_2020_clip >= .75\nBII_75per_2017 = phx_2017_clip >= .75\n\n# Calculate the percent of area in each raster with BII ≥ 0.75\nBii_2020 = (BII_75per_2020.sum() / BII_75per_2020.count())*100\nBii_2017 = (BII_75per_2017.sum() / BII_75per_2017.count())*100\n```\n:::\n\n\n::: {#a06ce085 .cell execution_count=9}\n``` {.python .cell-code}\n# Find pixels that had a BII >= .75 in 2017 but not in 2020\nBii_lost_area = BII_75per_2017 & (~BII_75per_2020)\n\n# Convert all 0 values to NAs if they don't meet the condition\nBii_lost_area_mask = Bii_lost_area.where(Bii_lost_area!=0)\n```\n:::\n\n\n::: {#36b32082 .cell execution_count=10}\n``` {.python .cell-code}\n# Create a visualization showing the area with BII>=0.75 in 2017 that was lost by 2020\nfig, ax = plt.subplots(figsize=(7, 6))\n\n# Create choropleth map\nphx_2020_clip.plot(cmap = 'Greens', cbar_kwargs={'location':'bottom', # Legend location\n                                                 'label':'BII for 2020'})\n\n# Plot the lost area\nBii_lost_area_mask.plot(ax=ax, cmap='Reds', add_colorbar = False)\n\n# Add title\nplt.suptitle('Biodiversity Intactness Index (BII)', fontsize=17, weight = 'bold')\n\n# Add subtitle\nax.set_title('Phoenix, AZ Subdivision', fontsize=17, weight='bold')\n\n# Add legend of BII\nlegend_elements = [patch.Patch(facecolor='red', \n                         label='Area with BII ≥ 0.75 lost from 2017 to 2020')]\n\n# Add a legend for BII loss\nax.legend(handles=legend_elements, loc='upper center', bbox_to_anchor=(0.5, -0.05), ncol=5, edgecolor = \"white\")\n\n# Remove axes\nax.axis('off')\n\n# Display the map\nplt.tight_layout()\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-11-output-1.png){width=662 height=568}\n:::\n:::\n\n\n## Map Description\n\nThe map above shows the Biodiversity Intactness Index (BII) across the Phoenix, AZ subdivision(in green), and areas where BII was \\>= .75 in 2017 but dropped in 2020(in red). These red ares are an indication that wild areas in the Phoenix region are decreasing in biodiversity compared to what would be expected in undisturbed ecosystems. This decline is most likely driven by fragmentation and urbanization.\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [],
    "includes": {}
  }
}